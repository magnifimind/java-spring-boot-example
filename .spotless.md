# Spotless Code Formatting

This project uses [Spotless](https://github.com/diffplug/spotless) with Google Java Format for consistent code formatting.

## Quick Commands

```bash
# Check if code is properly formatted
./gradlew spotlessCheck

# Auto-format all code
./gradlew spotlessApply
```

## What Spotless Does

### Java Files

- **Google Java Format (v1.19.1)** - Applies Google's Java style guide formatting
- **No Wildcard Imports** - Blocks wildcard imports like `import java.util.*`
- **Import Ordering** - Automatically sorts imports alphabetically
- **Remove Unused Imports** - Cleans up unused import statements
- **Trailing Whitespace** - Removes trailing whitespace from lines
- **End with Newline** - Ensures files end with a newline character

### Kotlin Gradle Files

- **ktlint** - Formats Kotlin DSL build files (`*.gradle.kts`)

## Excluded Files

Generated code is excluded from formatting checks:
- `build/generated/**` - OpenAPI generated code

## Integration with Build

Spotless is automatically run during the build process:

```bash
./gradlew build
```

This includes a `spotlessCheck` task. If formatting violations are found, the build will fail with a message:

```
Run './gradlew spotlessApply' to fix these violations.
```

## Wildcard Import Protection

The project enforces a strict no-wildcard-imports policy. If you try to use:

```java
import java.util.*;  // ❌ NOT ALLOWED
```

You'll get an error:

```
Wildcard imports are not allowed. Found: import java.util.*;
```

Instead, use explicit imports:

```java
import java.util.List;      // ✅ CORRECT
import java.util.ArrayList; // ✅ CORRECT
```

## Pre-commit Hook (Optional)

You can add Spotless to your pre-commit hook by creating `.git/hooks/pre-commit`:

```bash
#!/bin/sh
./gradlew spotlessApply
git add -u
```

Then make it executable:

```bash
chmod +x .git/hooks/pre-commit
```

## IDE Integration

### IntelliJ IDEA

1. Install the "google-java-format" plugin
2. Go to Settings → Other Settings → google-java-format Settings
3. Enable "google-java-format"
4. Your code will be formatted on save

### VS Code

1. Install the "Language Support for Java" extension
2. Install the "google-java-format" formatter
3. Configure in settings.json:

```json
{
  "java.format.settings.url": "https://raw.githubusercontent.com/google/styleguide/gh-pages/eclipse-java-google-style.xml",
  "editor.formatOnSave": true
}
```

## Troubleshooting

### Build Fails with Formatting Errors

Run `./gradlew spotlessApply` to auto-fix all formatting issues.

### Spotless Not Detecting Changes

Clear the Gradle cache:

```bash
./gradlew clean spotlessApply
```

### IDE Formatting Conflicts

Make sure your IDE is using Google Java Format. If you have different formatting rules in your IDE, disable them or configure them to match Google's style guide.

## Configuration

The Spotless configuration is in `build.gradle.kts`:

```kotlin
spotless {
    java {
        target("src/*/java/**/*.java")
        targetExclude("build/generated/**")
        googleJavaFormat("1.19.1")
        removeUnusedImports()
        importOrder()
        custom("noWildcardImports") { ... }
        trimTrailingWhitespace()
        endWithNewline()
    }
}
```

## Further Reading

- [Spotless Documentation](https://github.com/diffplug/spotless)
- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- [Google Java Format](https://github.com/google/google-java-format)
